# EchoSky Web View 機能一覧

## ✅ MVP（最小で“使える”まで）

### 認証・アカウント

* atprotoログイン（PDS選択／セッション保存）
* DID/ハンドル表示、プロフィール簡易表示（アイコン・名前）

### コミュニティ（Discord的“部屋”の最小構成）

* コミュニティ（Room/Guild）一覧表示

  * 参加済み・おすすめ・新着（最低でも参加済み）
* コミュニティ詳細

  * 概要（説明、規約、モデレータ表記）
  * スレッド（Topic）一覧（新着順／更新順）
* スレッド詳細（2ch風ビュー）

  * レス（Post）を時系列表示（クライアント採番 #1, #2, …）
  * メンション表示：`@handle` → リンク化（facet解釈）
  * 参照アンカー（>>n / refPost）ジャンプ
  * ページング（時間カーソル or 無限スクロール）
* 投稿UX

  * 新規スレ作成（タイトル、説明任意）
  * レス投稿（Markdown or プレーンテキスト、メンション補完）
  * 引用返信（選択→引用挿入 or refPost セット）
* リアクション

  * レスごとの集計表示（like/laugh/sad/angry/star）
  * 自分のリアクションのオン／オフ（冪等 upsert）

### 検索・ナビ

* コミュニティ内検索（タイトル・本文の簡易フィルタ ※初期はクライアント側）
* 絞り込み（未読／自分が投稿／@メンションあり）

### モデレーション（最小）

* 通報リンク（通報レコード作成 or 外部フォーム）
* ミュート／ブロック（表示側フィルタ適用）
* 削除済み表示の墓標化（編集不可・削除は墓標で残す）

### 非機能

* A11y：キーボード操作、見出し構造、コントラスト
* i18n：en をデフォルト、ja も用意（文言辞書）
* パフォーマンス：リストの仮想化、画像遅延読み込み
* リンクのOG展開（URL貼付時にタイトル/サムネ取得）
* エラーハンドリング：投稿失敗時のリトライ・ドラフト保存

---

## 🔜 Next（コミュニティ“居心地”を高める）

### コミュニティ機能の拡充

* 参加／退出（Join/Leave）
* 招待リンク（有効期限／回数）
* 役職ロール（Owner/Mod/Member）表示

### タイムラインと通知

* 自分の所属コミュニティ横断“ホーム”タイムライン
* メンション／返信／引用／リアクションの通知リスト
* 未読管理（最終閲覧時刻を保持してハイライト）

### 投稿編集・下書き

* 下書き保存・再開
* 投稿編集（更新履歴の簡易表示）※方針：編集は〇分以内などルール化
* 画像添付（BLOB）・簡易プレビュー

### 検索の強化（ビューサービス前提でもOK）

* フルテキスト検索（タイトル・本文）
* ユーザー検索（ハンドル／表示名）
* タグ（コミュニティ内の話題分類）

### モデレーション拡張

* コミュニティ規約の強制表示・同意履歴
* スパム検知（リンク多すぎ・連投などの簡易ヒューリスティック）
* 管理者機能：ピン留め、スレのロック、投稿のモデレートキュー

### 共有・埋め込み

* スレ／レスのパーマリンク（`at://` → `https://app/…` ディープリンク）
* 外部埋め込みカード（OGP）

### 品質・運用

* エラーログ／計測（Web Vitals、遷移、投稿成功率）
* PWA（オフライン下書き・アイコン・インストール）

---

## 🚀 Stretch（差別化・快適体験）

### リアルタイム性

* Firehose購読でスレ更新をプッシュ反映（楽観UI＋差分マージ）
* タイピングインジケータ（簡易）：投稿編集中の表示（プライバシーに配慮）

### レコメンド・発見性

* 参加コミュニティに基づくスレッド推薦
* ユーザーの関心ラベルに基づくおすすめ

### 高度な権限・セキュリティ

* プライベートコミュニティ（承認制、鍵付き）
* 招待コードパラメータの制御（有効期限、最大人数）
* エキスパート・モデレーターの信頼スコア

### 文化機能

* 定型リアクションのカスタム（コミュニティごとの絵文字セット）
* ウィキ／ガイド（コミュニティ知識を静的ページで）

---

## 🔧 データ連携（Lexiconとの対応）

> 例：パッケージ `@echosky/lexicons` とし、コレクションIDは `com.echosky.*` を想定（実際のIDに合わせて置換）。

実物のパッケージ用意しました -> https://www.npmjs.com/package/@echosky/board-lexicons


* **コミュニティ**：`com.echosky.community`

  * `name, description, createdAt, visibility(public|private), roles[]`
* **スレッド**：`com.echosky.thread`

  * `community (ref), title, createdAt, pinned?`
* **投稿**：`com.echosky.post`

  * `thread (ref|at-uri), text, createdAt, facets[], refPost(StrongRef|null)`
* **リアクション**：`com.echosky.reaction`

  * `subject(StrongRef), reaction(enum), createdAt`（rkeyで冪等）
* **招待**（Next）：`com.echosky.invite`

  * `community, code, expiresAt, maxUses, usedCount`
* **通知**（Next）：`com.echosky.notice`（またはビュー側で派生）

---

## 🧭 ユーザーフロー（MVP基準）

1. **ログイン** → PDS選択 → セッション保存
2. **コミュニティ一覧**（参加済み）→ 1つ選ぶ
3. **スレ一覧**（更新新しい順）→ 気になるスレを開く
4. **スレ詳細**

   * レスを読む（#採番、メンションリンク、アンカー）
   * リアクション or 引用返信 or 新規レス
5. **スレ作成**（必要に応じて）
6. **通知**（Next以降）：自分宛メンション・返信を確認

---

## 🧱 技術要件（実装メモ）

* **API**：`@atproto/api` の `createRecord / listRecords / getRecord / putRecord`
* **並び順と同時刻衝突**：`createdAt asc` + `uri` の安定ソート
* **ページング**：時間カーソル（`since`/`until`）＋無限スクロール
* **メンション**：`app.bsky.richtext.facet` 準拠で生成・表示
* **リンク検出**：URL自動検出 → OGP（サーバ側で unfurl も可）
* **リアクション冪等**：`rkey = base64url(subjectUri|kind|did)` で `putRecord`
* **ドラフト**：LocalStorage か IndexedDB（投稿失敗時の復元）
* **i18n**：`en` 基準、`ja` セカンド（Day.js/Intlで日付ローカライズ）

---

## 📋 受け入れ基準（MVP抜粋）

* [ ] ログイン後、**参加コミュニティ→スレ→レス**の3階層で移動できる
* [ ] スレ詳細で**50件以上**のレスを**時系列**に**安定表示**できる
* [ ] `@handle` が**リンク化**され、詳細に飛べる
* [ ] `>>n` クリックで**対象レスにジャンプ**できる
* [ ] リアクションが**即時反映**され、**自分の状態**が分かる
* [ ] 投稿失敗時、**下書きが保持**される
* [ ] A11y：Tab移動で投稿・リアクション操作ができる

---
